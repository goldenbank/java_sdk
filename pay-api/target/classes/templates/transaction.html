<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>交易模拟</title>
</head>
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="http://static.runoob.com/assets/jquery-validation-1.14.0/dist/jquery.validate.min.js"></script>
<body>
<div class="page-header" style="text-align: center">
    <h5 style="color: goldenrod">金盾钱包SDK在线调试</h5>
</div>
<div class="row">
    <div class="col-sm-1" style="padding: 10px 20px 10px 0px;">
        <p class="text" style="text-align: center ;color:deepskyblue ;padding-left: 30px" >调试菜单</p>
        <nav class="navbar bg-light">
            <ul class="navbar-nav" style="list-style:none" ;>
                <li class="nav-item" style="padding:10px 0px 10px 0px">
                    <a class="nav-link" href="./index">获取token</a>
                </li>
                <li class="nav-item" style="padding:10px 0px 10px 0px">
                    <a class="nav-link" href="./address">获取地址</a>
                </li>
                <br>
                <li class="nav-item" style="padding:10px 0px 10px 0px">
                    <a class="nav-link" href="./transfer">提币申请</a>
                </li>
                <br>
                <li class="nav-item" style="padding:10px 0px 10px 0px">
                    <a class="nav-link" href="./check">检验地址</a>
                </li>
                <br>
                <li class="nav-item" style="padding:10px 0px 10px 0px">
                    <a class="nav-link" href="./transaction">交易模拟</a>
                </li>
                <li class="nav-item" style="padding:10px 0px 10px 0px">
                    <a class="nav-link" href="./strategy">币种策略</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="col-sm-5">
        <div style="padding: 10px 100px 10px 0px;width:800px;">
            <form class="bs-example bs-example-form" role="form" id="form">
                <div class="input-group input-group">
                    <span class="input-group-addon">单号</span>
                    <input id="tId" type="text" class="form-control" name="tradeId" th:value="*{transaction.tradeId}" placeholder="请输入">
                </div>
                <br>
                <div class="input-group">
                    <span class="input-group-addon">地址</span>
                    <input id="ad1" type="text" class="form-control" name="address" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">链上交易Id</span>
                    <input id="t1" type="text" class="form-control" name="txId" th:value="*{transaction.TxId}" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">主币编码</span>
                    <input id="mt1" type="text" class="form-control" name="mainType" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">子币种编码/合约</span>
                    <input id="s1" type="text" class="form-control" name="subType" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">交易金额</span>
                    <input id="a1" type="text" class="form-control" name="amount" value="10" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">手续费</span>
                    <input id="f1" type="text" class="form-control" name="fee" value="1" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">币种精度</span>
                    <input id="p1" type="text" class="form-control" name="precisions" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">商户单号</span>
                    <input id="o1" type="text" class="form-control" name="outerId" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">备注</span>
                    <input id="m1" type="text" class="form-control" name="memo" value="测试" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">区块高度</span>
                    <input id="bck" type="text" class="form-control" name="blockHeight"  value="2000" placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">回调URL</span>
                    <input id="ca1" type="text" class="form-control" name="callUrl"  placeholder="请输入">
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">审核状态</span>
                    <select class="form-control input-sm" name="status" id="fft">
                        <option value="2">通过</option>
                        <option value="3">转账中</option>
                        <option value="5">驳回</option>、
                        <option value="4">成功</option>
                        <option value="6">失败</option>

                    </select>
                </div>
                <br>
                <div class="input-group input-group">
                    <span class="input-group-addon">交易类型</span>
                    <select class="form-control input-sm" name ="tradeType" id="tdt">
                        <option value="0">提币</option>
                        <option value="1">充值</option>
                    </select>
                </div>
                <br>
                <button id="btn" type="button" class="btn btn-default" onclick="tibia()">提交</button>
            </form>
            <br>
            <div class="alert alert-info">
                <p class="text">请先获取token</p>
                <p class="text">所有参数请参考SDK对接文档正确填写</p>
                <p class="text">测试回调url http://xxx:7000/sdk-debug/api/back</p>
            </div>
        </div>
    </div>
    <div class="col-sm-5" style="padding: 10px 100px 10px 100px;">
        <h4>返回结果</h4>
        <textarea rows="20" cols="75" id="h4">
        </textarea>
    </div>
</div>

<script type="text/javascript">
    function getBasePath(){
        let path = window.location.pathname.split("/");
        let basePath = path[0]+"/"+path[1]+"/";
        return basePath;
    }
    function tibia(){
//调用.form()方法来真正执行表单验证。
        if(validateForm().form()){
            $.ajax({
                type: "post",
                url: getBasePath()+"api/transactionInfo",
                data: JSON.stringify({
                    callUrl: $('#cl').val()
                    ,tradeId:$('#tId').val()
                    ,address:$('#ad1').val()
                    ,txId:$('#t1').val()
                    ,mainType:$('#mt1').val()
                    ,subType:$('#s1').val()
                    ,amount:$('#a1').val()
                    ,fee:$('#f1').val()
                    ,precisions:$('#p1').val()
                    ,outerId:$('#o1').val()
                    ,memo:$('#m1').val()
                    ,blockHeight:$('#bck').val()
                    ,callUrl:$('#ca1').val()
                    ,status:$('#fft').val()
                    ,tradeType:$('#tdt').val()
                }),
                // data: params,
                contentType: 'application/json',
                success: function (result) {
                    if(result.code==200)
                    $('#h4').html(JSON.stringify(result.code+"交易处理成功!"))
                    console.log(result);
                    if(result.code==500){
                        $('#h4').html(JSON.stringify(result.code+"交易处理失败!"));
                    }
                    if(result.code==4000){
                        $('#h4').html(JSON.stringify(result.code+result.message));
                    }

                },
                error: function (result) {
                    $('#h4').html("测试失败！");
                }
            });

        }
    }
    //1、定义表单验证的方法，返回表单验证结果：true或false
    //（此处并不执行表单验证，只是定义一个有返回值的方法）
    function validateForm() {
        return $("#form").validate({
            rules: {
                callUrl : {required: true},
                tradeId: {required: true},
                address:{required: true},
                txId:{required: true},
                mainType:{required: true},
                subType:{required: true},
                amount:{required: true},
                fee:{required: true},
                precisions:{required: true},
                outerId:{required: true},
                memo:{required: true},
                blockHeight:{required: true},
                status:{required: true},
                tradeType:{required: true}
            },
            messages: {
                callUrl: {required: "这是必填字段"},
                tradeId: {required: "这是必填字段"},
                address:{required: "这是必填字段"},
                txId:{required: "这是必填字段"},
                mainType:{required: "这是必填字段"},
                subType:{required: "这是必填字段"},
                amount:{required: "这是必填字段"},
                fee:{required: "这是必填字段"},
                precisions:{required: "这是必填字段"},
                outerId:{required: "这是必填字段"},
                memo:{required: "这是必填字段"},
                blockHeight:{required: "这是必填字段"},
                status:{required: "这是必填字段"},
                tradeType:{required: "这是必填字段"}
            }
        });
    }
</script>
</body>
</html>